<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Dyslexim</title>
    <!-- CSS will be injected by Python -->
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap');

        /* OpenDyslexic font removed due to CORS issues - will be loaded separately if needed */

        body {
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
        }

        .onboarding-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .onboarding-card {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-2xl);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            padding: var(--space-8);
            animation: slideUp var(--transition-base);
        }

        .onboarding-step {
            display: none;
        }

        .onboarding-step.active {
            display: block;
            animation: fadeIn var(--transition-base);
        }

        .step-number {
            display: inline-flex;
            background: var(--primary-500);
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: var(--space-4);
            font-size: var(--text-sm);
            box-shadow: 0 0 20px rgba(10, 132, 255, 0.3);
        }

        .step-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--space-3);
        }

        .step-description {
            color: var(--neutral-600);
            margin-bottom: var(--space-8);
            font-size: var(--text-base);
            line-height: 1.6;
        }

        .settings-grid {
            display: grid;
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .setting-row {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .setting-label {
            font-weight: 600;
            color: var(--neutral-700);
            font-size: var(--text-sm);
        }

        .setting-input-group {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        input[type="color"] {
            width: 4rem;
            height: 4rem;
            border: 2px solid var(--neutral-300);
            background: var(--neutral-100);
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: var(--radius-lg);
        }

        input[type="color"]:hover {
            border-color: var(--primary-500);
            box-shadow: 0 0 15px rgba(10, 132, 255, 0.3);
        }

        .color-label {
            font-size: var(--text-sm);
            color: var(--neutral-600);
        }

        .navigation-buttons {
            display: flex;
            gap: var(--space-4);
            margin-top: var(--space-8);
            justify-content: space-between;
        }

        .btn-nav {
            flex: 1;
        }

        .progress-bar {
            height: 3px;
            background: var(--neutral-200);
            border-radius: 2px;
            margin-bottom: var(--space-8);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-500);
            transition: width var(--transition-base);
            box-shadow: 0 0 10px rgba(10, 132, 255, 0.5);
        }

        .feature-highlight {
            background: rgba(10, 132, 255, 0.1);
            border-left: 4px solid var(--primary-500);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-6);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: var(--space-2);
        }

        .feature-title {
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--space-2);
        }

        .feature-text {
            font-size: var(--text-sm);
            color: var(--neutral-600);
        }

        select, input[type="number"] {
            background: var(--neutral-100);
            color: var(--neutral-900);
            border: 1px solid var(--neutral-300);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-family: var(--font-family-base);
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.2);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(2rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--neutral-100);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid var(--neutral-200);
        }

        .checkbox-wrapper:hover {
            background: var(--neutral-200);
            border-color: var(--neutral-300);
        }

        .checkbox-wrapper input[type="checkbox"] {
            cursor: pointer;
        }

        .checkbox-label {
            cursor: pointer;
            color: var(--neutral-700);
            font-size: var(--text-sm);
            font-weight: 500;
        }

        .success-icon {
            display: none;
            color: var(--success-500);
            font-size: 1.5rem;
            margin-top: var(--space-4);
        }

        .success-icon.show {
            display: block;
            animation: slideInRight var(--transition-base);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(1rem);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 640px) {
            .onboarding-card {
                padding: var(--space-6);
            }

            .setting-input-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <div class="onboarding-card">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Step 1: Welcome -->
            <div class="onboarding-step active" id="step1">
                <div class="step-number">1</div>
                <h1 class="step-title">Welcome to Dyslexim</h1>
                <p class="step-description">Your intelligent reading companion for a better browsing experience.</p>
                
                <div class="feature-highlight">
                    <div class="feature-icon">📖</div>
                    <div class="feature-title">Smart Reading Assistance</div>
                    <div class="feature-text">Customize your reading experience with highlight colors, font choices, and more.</div>
                </div>

                <div class="feature-highlight">
                    <div class="feature-icon">⚡</div>
                    <div class="feature-title">Lightning Fast</div>
                    <div class="feature-text">Optimized for performance and smooth interactions.</div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-primary btn-nav" onclick="nextStep()">Get Started →</button>
                </div>
            </div>

            <!-- Step 2: Highlight Color -->
            <div class="onboarding-step" id="step2">
                <div class="step-number">2</div>
                <h1 class="step-title">Reading Experience</h1>
                <p class="step-description">Choose how your reading is highlighted and displayed.</p>
                
                <div class="settings-grid">
                    <div class="setting-row">
                        <div class="setting-label">Highlight Color</div>
                        <div class="setting-input-group">
                            <input type="color" id="highlightColor" value="#ffc800">
                            <div class="color-label" id="colorLabel">Golden Yellow</div>
                        </div>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">Text Font</div>
                        <select id="font" style="padding: var(--space-3) var(--space-4); border: 1px solid var(--neutral-300); border-radius: var(--radius-lg);">
                            <option value="Poppins">Poppins (Modern)</option>
                            <option value="Roboto">Roboto (Clean)</option>
                            <option value="Open Sans">Open Sans (Friendly)</option>
                            <option value="OpenDyslexic">OpenDyslexic (Dyslexia-friendly)</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">Highlight Position</div>
                        <select id="highlightAlignment" style="padding: var(--space-3) var(--space-4); border: 1px solid var(--neutral-300); border-radius: var(--radius-lg);">
                            <option value="left">Left-aligned</option>
                            <option value="center">Center-aligned</option>
                            <option value="right">Right-aligned</option>
                        </select>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-secondary btn-nav" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary btn-nav" onclick="nextStep()">Next →</button>
                </div>
            </div>

            <!-- Step 3: Advanced Settings -->
            <div class="onboarding-step" id="step3">
                <div class="step-number">3</div>
                <h1 class="step-title">Advanced Settings</h1>
                <p class="step-description">Fine-tune your experience for optimal reading.</p>
                
                <div class="settings-grid">
                    <div class="setting-row">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="readingMask" checked>
                            <label for="readingMask" class="checkbox-label">Enable Reading Mask (helps focus on current line)</label>
                        </div>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">TTS Hover Time (seconds)</div>
                        <input type="number" id="ttsHoverTime" min="0.5" max="5" step="0.1" value="1.0" 
                               style="padding: var(--space-3) var(--space-4); border: 1px solid var(--neutral-300); border-radius: var(--radius-lg);">
                        <div class="feature-text" style="margin-top: var(--space-2);">How long to hover before text-to-speech triggers.</div>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">Default Search Engine</div>
                        <select id="searchEngine" style="padding: var(--space-3) var(--space-4); border: 1px solid var(--neutral-300); border-radius: var(--radius-lg);">
                            <option value="Google">Google</option>
                            <option value="Bing">Bing</option>
                            <option value="DuckDuckGo">DuckDuckGo</option>
                            <option value="Yahoo">Yahoo</option>
                            <option value="Brave">Brave Search</option>
                        </select>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-secondary btn-nav" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary btn-nav" onclick="nextStep()">Next →</button>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="onboarding-step" id="step4">
                <div class="step-number">4</div>
                <h1 class="step-title">You're All Set!</h1>
                <p class="step-description">Your Dyslexim experience is ready. Click below to start browsing.</p>
                
                <div class="feature-highlight">
                    <div class="feature-icon">✅</div>
                    <div class="feature-title">Configuration Saved</div>
                    <div class="feature-text">All your preferences have been saved and will be applied to every page you visit.</div>
                </div>

                <div class="success-icon show">✓</div>

                <div class="navigation-buttons">
                    <button class="btn btn-secondary btn-nav" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary btn-nav btn-lg" onclick="finishOnboarding()">Start Browsing →</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let pyHandler = null;

        // Initialize WebChannel
        new QWebChannel(qt.webChannelTransport, function (channel) {
            try {
                pyHandler = channel.objects.handler;
                console.log("✓ Onboarding: WebChannel connected");
            } catch (err) {
                console.error("✗ WebChannel error:", err);
            }
        });

        function showStep(stepNum) {
            // Hide all steps
            document.querySelectorAll('.onboarding-step').forEach(step => {
                step.classList.remove('active');
            });

            // Show current step
            const stepElement = document.getElementById(`step${stepNum}`);
            if (stepElement) {
                stepElement.classList.add('active');
            }

            // Update progress bar
            const progress = (stepNum / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            currentStep = stepNum;
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                showStep(currentStep + 1);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function finishOnboarding() {
            const color = document.getElementById('highlightColor').value;
            const font = document.getElementById('font').value;
            const alignment = document.getElementById('highlightAlignment').value;
            const readingMask = document.getElementById('readingMask').checked;
            const ttsHoverTime = parseFloat(document.getElementById('ttsHoverTime').value) || 1.0;
            const searchEngine = document.getElementById('searchEngine').value;

            if (pyHandler && typeof pyHandler.saveSettings === 'function') {
                try {
                    pyHandler.saveSettings(color, font, alignment, readingMask, ttsHoverTime, searchEngine);
                    console.log("✓ Settings saved successfully");
                    // Settings saved - the Python side will handle navigation
                } catch (err) {
                    console.error("✗ Error saving settings:", err);
                    alert("Error: Could not save settings. Please try again.");
                }
            } else {
                console.error("✗ Handler not available");
                alert("Error: Connection to app lost. Please refresh.");
            }
        }

        // Update color label when color picker changes
        document.getElementById('highlightColor').addEventListener('change', function() {
            const colorMap = {
                '#ffc800': 'Golden Yellow',
                '#ffff00': 'Bright Yellow',
                '#00d4ff': 'Cyan',
                '#ff6b6b': 'Red',
                '#51cf66': 'Green',
                '#ff922b': 'Orange',
                '#cc5de8': 'Purple'
            };
            const label = colorMap[this.value] || 'Custom Color';
            document.getElementById('colorLabel').textContent = label;
        });

        // Initialize
        console.log("Onboarding page loaded");
        showStep(1);
    </script>
</body>
</html>